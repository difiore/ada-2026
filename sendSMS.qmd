---
title: "Send a Text Message from R"
---

```{r}
library(emayili)
```

Common US gateways (examples):

AT&T: number@txt.att.net
Verizon: number@vtext.com
T-Mobile: number@tmomail.net
(Confirm current gateways; they can change and may have limits.)

```{r}
pwd_gmail <- "dojf doba nhmt dcba"
smtp_gmail <- server(
  host = "smtp.gmail.com",
  port = 465,
  max_times = 1,
  username = "anthony.difiore@gmail.com",
  password = pwd_gmail
)

msg <- envelope() %>%
  from("anthony.difiore@utexas.edu") |>
  to("6464004285@tmomail.net") |>   # Replace with recipient’s carrier gateway
  text("Hello from R using email-to-SMS!")

smtp_gmail(msg, verbose = TRUE)
```

# Using Textbelt

Got to [https://textbelt.com/](https://textbelt.com/)
Create an API key ($3 for 50 messages)

## Checking your quota
Use /quota/<key> to view remaining quota. For example, if your key is abc123...

````
$ curl https://textbelt.com/quota/abc123
````

```{bash}
curl https://textbelt.com/quota/fe40d06b937ce145c7e4f282001a92a827886db2SCKTEDTXUJNA6t4Pxn6ftaLJ2
```

## Testing your key
If you want to validate your key without actually using your text quota, append "_test" to your key and you will receive a response from the /text endpoint confirming that a text would send, but it will not consume your credits.


```{r}
library(httr)

key <- "fe40d06b937ce145c7e4f282001a92a827886db2SCKTEDTXUJNA6t4Pxn6ftaLJ2"

send_textbelt_sms_simple <- function(phone, message, api_key = key) {
  url <- "https://textbelt.com/text"
  res <- POST(
    url,
    body = list(
      phone = phone,
      message = message,
      key = api_key
    ),
    encode = "form"
  )
  stop_for_status(res)
  result <- content(res, "parsed")
  # Print delivery status
  if (result$success) {
    cat("✅ SMS sent successfully!\n")
  } else {
    cat("❌ SMS failed: ", result$error, "\n")
  }
  return(result)
}

send_textbelt_sms_log <- function(phone, message, api_key = key, check_status = TRUE, poll_interval = 5, max_checks = 6) {
  # Step 1: Send SMS
  url <- "https://textbelt.com/text"
  res <- POST(
    url,
    body = list(
      phone = phone,
      message = message,
      key = api_key
    ),
    encode = "form"
  )
  stop_for_status(res)
  result <- content(res, "parsed")
  log <- list(initial_response = result, status_checks = list())
  if (!result$success) {
    cat("❌ SMS failed: ", result$error, "\n")
    return(log)
  }
  cat("✅ SMS sent successfully!\n")
  # Step 2: Poll for delivery status (paid keys only)
  if (check_status && !is.null(result$textId)) {
    status_url <- paste0("https://textbelt.com/status/", result$textId)
    for (i in 1:max_checks) {
      Sys.sleep(poll_interval)
      status_res <- GET(status_url)
      status <- content(status_res, "parsed")
      log$status_checks[[i]] <- status
      cat(sprintf("Status check %d: %s\n", i, status$status))
      if (status$status == "DELIVERED") {
        cat("✅ Message delivered!\n")
        break
      }
    }
  }
  return(log)
}

# Example usage:
phone <- "+16464004285"
message <- "This is a test of SMS from R using Textbelt"
status_log <- send_textbelt_sms_log(phone, message)
```
